<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>A Map of Chicago Artists Portrait</title>

    <!-- Bootstrap -->
    <link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">

    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />

    <style>
		html,
		body {
			overflow-x: hidden;
			/* Prevent scroll on narrow devices */
		}

		body .row {
			padding-top: 100px;
		}

		i {
			color: #333;
		}

		.inMap {
			color: #000000;
		}

		.offMap {
			color: #666;
			display: inline-block;
			width: 180px;
		}

		.info {
			padding: 6px 8px;
			font: 14px/16px Arial, Helvetica, sans-serif;
			background: white;
			background: rgba(255, 255, 255, 0.8);
			box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
			border-radius: 5px;
		}

		.info h4 {
			margin: 0 0 5px;
			color: #777;
	}
    </style>
</head>

<body>
    <nav id="header" class="navbar navbar-fixed-top navbar-inverse">
        <div id="header-containe4r" class="container navbar-container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                          <span class="sr-only">Toggle navigation</span>
                          <span class="icon-bar"></span>
                          <span class="icon-bar"></span>
                          <span class="icon-bar"></span>
                      </button>
                <a id="brand" class="navbar-brand" href="#">A Map of a 2015 Chicago Artists Group Portrait</a>
            </div>
            <div id="navbar" class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="#aboutSection">About </a></li>
                    <li><a href="#mapSection">The Map</a></li>
                    <li> <a href="#addnfo">Contribute information</a></li>
                    <li><a href="#FaqSection">faq</a></li>
                    <li><a href="#notOnTheMap">not on the map</a></li>
                </ul>
            </div>
            <!-- /.nav-collapse -->
        </div>
        <!-- /.container -->
    </nav>
    <!-- /.navbar -->


    <div class="container">
        <div class="row" id="aboutSection">
            <p>This page was made and is maintained by <a href="http://www.dubster.com">Dubi kaufmann</a> and its goal is to connect names to faces in a large group photo.
              The group photo was taken in chicago in 2015 by <a href="http://jasonlazarus.com">Jason Lazaus </a>.
              <br>
              pasete from <a href="http://jasonlazarus.com/project_3_495/2004present">Jason Lazaus site</a><p>
              <p><i> On Saturday, June 20th, 2015, ALL self-identifying Chicago Artists were invited to sit for a group portrait on the steps of the Museum of Contemporary Art, Chicago, IL. The open ended and non-discriminating gesture brought a diverse array of artists from across the city to form this historical moment. Photo Assistants: Aron Gent and Patrick Putze.
*This portrait, available in high resolution, has been released to the public domain. It can be accessed at the Internet Archive: <a href="https://archive.org/details/ChicagoArtistGroupPortrait2015">https://archive.org/details/ChicagoArtistGroupPortrait2015</a>
</i><p>
              <p> This page is open source and code is on <a href="https://github.com/dubster2k/dubster2k.github.io/tree/master/chicagoartistsphoto">Github</a> there is also
                a spreadsheet with <a href="https://docs.google.com/spreadsheets/d/11XJtPkqNhz771uD_zByYI8hveJGcrZd97GsEA1kdfMM/edit?usp=sharing">a list of names and coodinates</a> (write protected) <br></p>



        </div>
    </div>
    <!--/.container -->

    <div class="container">
        <div class="row" id="mapSection">
            <div class="col-md-12">
                <div id="map" style="width: 500px; height: 350px"></div>
            </div>
            <p>search:<input type="text" id="searchAutoComplete"></p>

            <div id="tabs">
                <ul id="tabLinks">


                </ul>


            </div>
        </div>
    </div>
    <!--/.container -->



    <div class="container">
        <div class="row" id=addnfo>

            <div class="col-md-12">
                <p> See yourself or someone you recognize? This page is crowed sourced. Send an email with the name, map coordinates and website(optional) to dubster2k-AT-yahoo-DOT-com. To get the coordinates of a person in the photo click on the map on the face and the coordinates will appear in a pop up.</p>
                <p> Questions/comments/corrections please email dubster2k-AT-yahoo-DOT-com</p></p>
            </div>


        </div>
    </div>
    <!--/.container -->

    <div class="container">
        <div class="row" id="FaqSection">

            <div class="col-md-12"><b>FAQ</b>
                <ul>
                    <li><b>Is this web page affiliated with jason lazarus?</b>
                        <p>No. The image he produced is in the public domain and was meant to be remixed</p>
                    </li>
                    <li><b>Which javascript libraries are used in this page?</b>
                        <p> <a href="http://leafletjs.com/">leaflet</a> for the map.
                          <a href="https://jquery.com/">jquery</a> for the search box autocomplete.
                          <a href="https://getbootstrap.com">bootstrap</a> for formatting.
                          <a href="https://github.com/jsoma/tabletop">tabletop</a> for using a Google spreadsheet as input.
                            </p>
                    </li>

                </ul>
            </div>


        </div>



    </div>
    <!--/.container -->




    <div class="container">
        <div class="row" id=notOnTheMap>

            <div class="col-md-12"><b>Missing from the Map</b>
                <p id=listParticipantsMissing></p>
            </div>

        </div>

    </div>
    <!--/.container -->


<!--external JS-->

<!-- jQuery (necessary for Bootstrap JavaScript plugins) -->
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
<!-- tableTop -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js'></script>
<script type='text/javascript'>

     //Globals
     var public_spreadsheet_url = 'https://docs.google.com/spreadsheets/d/11XJtPkqNhz771uD_zByYI8hveJGcrZd97GsEA1kdfMM/edit?usp=sharing';

    var participants =[];
    var participantsOffMap = [];

    var showLon = 0;
    var showLat = 0;

    function addPolygon(pos) {
		var person = participants[pos];
		var lat = parseFloat(person.lat);
		var lon = parseFloat(person.lon);
		L.polygon([
			[lat + 0.5, lon + 0.5],
			[lat + 0.5, lon - 0.5],
			[lat - 0.5, lon - 0.5],
			[lat - 0.5, lon + 0.5]
		], {
			weight: 2,
			color: '#f00',
			fillColor: null,
			fillOpacity: 0,
			infoTag: pos

		})
		.addTo(faces)
		.on("click", function(e) {
			getInfo(e.target.options.infoTag)
		});
    }

	function onMapClick(e) {
		// Do we really need to see the location on the map? I noticed this more than the person's name in the info box
		var coorinatesString = "latitude = " + e.latlng.lat.toFixed(3) + ", longtitude = " + e.latlng.lng.toFixed(3);
		popup
			.setLatLng(e.latlng)
			.setContent(coorinatesString)
			.openOn(map);
	}

    function showLatLon() {
        map.setView(L.latLng(showLat, showLon), 5, {
            animation: true
        });
    }

    function getInfo(pos) {
		var person = participants[pos];
        showLat = person.lat;
        showLon = person.lon;
        info.update(pos);
        showLatLon();
    }

	function addButton(pos) {
		var person = participants[pos];
		var letter = person.value.toUpperCase().charAt(0);

		// if is a valid UTF-16 icode...
		if ((letter.charCodeAt(0) > 64) && (letter.charCodeAt(0) < 91)) {
			$('<button class="inMap">' + person.value + '</button>')
				.on('click', function(e) {
					getInfo(pos);
				})
				.appendTo("#tabs-" + letter);
		}
	}

	function offMap(_index) {
		$("<span></span>", {
			"class": "offMap",
		}).text(participants[_index].value + "  ").appendTo("#listParticipantsMissing");
	}

	function addAutoComplete() {
		$("#searchAutoComplete").autocomplete({
			source: participants,
			focus: function(event, ui) {
				showLat = ui.item.lat;
				showLon = ui.item.lon;
				showLatLon();
			},
			select: function(event, ui) {
				getInfo(ui.item.id)

			}
		});
	}

	function removeTabs() {
		var i = 0;

        for (i; i < 26; i++) {
			var tabLetter = String.fromCharCode(65 + i);
			var tab = $("#tabs-" + tabLetter);

			if (tab && tab.html() == "") {
				tab.remove();
				$("#labelTab-" + tabLetter).remove();
			}
		}

		$("#tabs").tabs("refresh");
	}

	function makeTabs() {
		var list = '';
		var tabs = '';
		var i = 0;

        for (i; i < 26; i++) {
            var tabLetter = String.fromCharCode(65 + i);
			list += '<li id="labelTab-' + tabLetter + '">';
			list += '<a href="#tabs-' + tabLetter + '">' + tabLetter + '</a>';
			list += '</li>';

			tabs += '<div id="tabs-' + tabLetter + '"></div>';
        }

		$("#tabLinks").append(list);

		$("#tabs").append(tabs)
			.tabs();
	}

	function processArray(data) {
		if (data) {
			participants = data;
			for (var i = participants.length - 1; i >= 0; i--) {
				if (isNaN(parseFloat(participants[i].lat))) {
					offMap(i);
					participants.splice(i, 1); // removes them from the array
				}
			}

			for (var i = participants.length - 1; i >= 0; i--) {
				participants[i].id = i; // for the autocomplete
				addPolygon(i);
				addButton(i);
			}

			removeTabs();
			addAutoComplete();
		} else {
			console.error('Could not return participants data.');
		}
	}

	/*
	* We are going to do all these things after we have our functions set,
	* since some of them are dependent on the functions
	**/

	// What is L? Leaflet?
	var faces = new L.LayerGroup();
	var popup = L.popup();
	var info = L.control();
	var map = L.map('map', {
		crs: L.CRS.Simple
	});
	var overlays = {
		"Show Square": faces
	};

	map.setView([-80, 110], 2)
		.on('click', onMapClick);

	// something is wrong here, it's not finding files based on this formay
	L.tileLayer('tiles/{z}-{x}-{y}.jpg', {
			minZoom: 0,
			maxZoom: 5,
			layers: [faces],
			tms: false,
			continuousWorld: true
		})
		.addTo(map);

	info.onAdd = function(map) {
		this._div = L.DomUtil.create('div', 'info');
		this.update();
		return this._div;
	};

	info.update = function(pos) {
		var infoString = 'Click on a square';
		if (pos) {
			var person = participants[pos];
			infoString = '<p>' + person.value + '</p>';
			if (person.url) {
				infoString += '<br /><a target="_blank" href="' + person.url + '">' + person.url + '</a>'
			}
		}
		this._div.innerHTML = infoString;
	};

	info.addTo(map);
	faces.addTo(map);

	L.control
		.layers(null, overlays)
		.setPosition('topright')
		.addTo(map);

	$(function() {
		Tabletop.init({
			key: public_spreadsheet_url,
			callback: processArray,
			simpleSheet: true
		});

		makeTabs();
	});
    </script>
</body>
</html>