<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>A map of Chicago Artists Portrait</title>

    <!-- Bootstrap -->
    <link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <script src="participantsArray.js" type="text/javascript"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">

    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <style>
  .header {}
  .inMap {color:#000000;}
  .offMap {color:#666;}
  .info {
			padding: 6px 8px;
			font: 14px/16px Arial, Helvetica, sans-serif;
			background: white;
			background: rgba(255,255,255,0.8);
			box-shadow: 0 0 15px rgba(0,0,0,0.2);
			border-radius: 5px;
		}
		.info h4 {
			margin: 0 0 5px;
			color: #777;
		}
  </style>
  <body>

   <nav class="navbar navbar-inverse">
     <div class="container">
         <div class="navbar-header">

             <h2 class="navbar-brand">A Map of 2015 Chicago Artists Group Portrait</h2>
         </div>

       </div><!--/.container -->
   </nav>
  <div class="container">
    <div class="row">
  <div class="col-md-6"><div id="map" style="width: 500px; height: 350px"></div></div>
  <div class="col-md-6">

    <p>About the photo on <a href="http://jasonlazarus.com/project_3_495/2004present">Jason Lazaus site</a><br>
    About the photo on <a href="https://archive.org/details/ChicagoArtistGroupPortrait2015">Archive.org</a><br>
    This map <s>was</s> is being created by <a href="http://dubster.com">Dubi Kaufmann</a><br>
    The source code is on <a href="https://github.com/dubster2k/dubster2k.github.io/tree/master/chicagoartistsphoto">Github</a><br>
    A spread sheet with <a href="https://docs.google.com/spreadsheets/d/11XJtPkqNhz771uD_zByYI8hveJGcrZd97GsEA1kdfMM/edit?usp=sharing">a list of names and coodinates</a> (latitude and longitude) <br></p>
    <p> To get the coordinates of a place in the photo click on it.</p>
    <p>
  </div>
</div>
</div>
<div class="container">
  <div class="row">
<div class="col-md-5"><b>On the Map</b><p id=listParticipantsDone></p></div>
<div class="col-md-3"><p><input type="text" id="tags"><button onclick="showLatLon();">Show</button></p></div>
<div class="col-md-4"><b>Missing from the Map</b><p id=listParticipantsMissing></p></div>


</div>
</div>




     <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>

     <script>
    var participantsDone=" ";
    var participantsMissing=" ";
    var showLon=0;
    var showLat=0;
    var faces = new L.LayerGroup();
    var popup = L.popup();
    var map = L.map('map', {

        crs: L.CRS.Simple
    }).setView([-80, 110], 2);
    L.tileLayer('tiles/{z}-{x}-{y}.jpg', {
        minZoom: 0,
        maxZoom: 5,
        layers: [faces],
        tms: false,
        continuousWorld:true
    }).addTo(map);
    map.on('click', onMapClick);
    var info = L.control();

    		info.onAdd = function (map) {
    			this._div = L.DomUtil.create('div', 'info');
    			this.update();
    			return this._div;
    		};

    		info.update = function (aPosition) {
          var infoString='<h2>Click on a square</h2>';
          if (aPosition)
          {
            infoString='<h2>'+participants[aPosition].value+'</h2>';
            if (participants[aPosition].url)
            {
              infoString=infoString+'<br><a href="'+participants[aPosition].url+'">'+participants[aPosition].url+'</a>'
            }
          }
    			this._div.innerHTML = infoString ;
    		};

    		info.addTo(map);


  for (var i = 0, len = participants.length; i < len; i++) {

    if  (participants[i].lat != null)
    {
    L.polygon([
      [(participants[i].lat+0.5), (participants[i].lon+0.5)],
      [(participants[i].lat+0.5), (participants[i].lon-0.5)],
      [(participants[i].lat-0.5), (participants[i].lon-0.5)],
      [(participants[i].lat-0.5), (participants[i].lon+0.5)]
    ],{
      weight: 2,
			color: 'black',
			fillColor: '#fff',
			fillOpacity: 0.05,
      alt:i

		}).addTo(faces).on("click", function(e)
  {getInfo(e.target.options.alt)} );//.bindPopup(participants[i].value);
    }

  }
faces.addTo(map);





var overlays = {
      "Show markers": faces
};


  L.control.layers(null,overlays).setPosition('topright').addTo(map);




    function onFaceClick(e) {
      popup
        .setLatLng(e.latlng)
        .setContent("face" + e.latlng.toString())
        .openOn(map);
    }

		function onMapClick(e) {
      var coorinatesString="latitude = "+ e.latlng.lat.toFixed(4)+", longtitude = "+ e.latlng.lng.toFixed(4);
      //coorinatesString=.toFixed(2);
      //console.log(e);
			popup
				.setLatLng(e.latlng)
				.setContent(coorinatesString)
				.openOn(map);
		}


    function setAndShow(myLat,myLon)
    {
      showLat= myLat ;
      showLon= myLon ;
      showLatLon();
    }
    function showLatLon()
    {
      map.setView(L.latLng(showLat,showLon ), 5, {animation: true});
    }
    function getInfo(arrayPosition)
  {
    //alert(event);
    showLat= participants[arrayPosition].lat ;
    showLon= participants[arrayPosition].lon ;
    info.update(arrayPosition)
    showLatLon();
  }

	</script>


    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script>
$(function() {


for (var i = 0, len = participants.length; i < len; i++) {

  if  (participants[i].lat != null)
  {
    $( "<button></button>", {
      "class": "inMap","arrayPosition":i,
      on: {
        click: function( event ) {
          getInfo($(this).attr("arrayPosition"));
    }
  }
}).text(participants[i].value).appendTo( "#listParticipantsDone" );
  }
  else {
    $( "<span></span>", {
      "class": "offMap","arrayPosition":i,
}).text(participants[i].value+"  ").appendTo( "#listParticipantsMissing" );
  }
}


  $( "#tags" ).autocomplete({
  source: participants,
  focus: function( event, ui ) {
    showLat= ui.item.lat ;
    showLon= ui.item.lon ;
  },
  select: function( event, ui ) {
    getInfo(ui.item.id)
    //showLat= ui.item.lat ;
    //showLon= ui.item.lon ;
  }
});

});
</script>
  </body>
</html>
